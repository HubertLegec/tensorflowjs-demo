(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1117:function(t,e,a){},1119:function(t,e,a){},1121:function(t,e,a){},1123:function(t,e,a){},1125:function(t,e,a){},1293:function(t,e,a){},1296:function(t,e,a){"use strict";a.r(e);var n=a(2),r=a.n(n),i=a(222),s=a.n(i),c=(a(566),a(34)),o=a.n(c),l=a(56),u=a(85),h=a(54),d=a(55),m=a(97),p=a(96),f=a(98),v=a(549),g=a.n(v),b=(a(570),a(320)),E=a(225),y=a.n(E),k=(a(1117),function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(t=Object(p.a)(e)).call.apply(t,[this].concat(r))))._sketch=null,a.onClearClick=function(){var t=a.props.onNewImage;a._sketch.clear(),t(void 0)},a.onRecognizeClick=function(){(0,a.props.onNewImage)(a.sketchImage)},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this,e=this.props,a=e.containerWidth,n=e.disabled,i="".concat(a-16,"px");return r.a.createElement("div",{className:"canvas"},r.a.createElement("header",{className:"canvas-header"},"Write your digit below:"),r.a.createElement(b.SketchField,{width:i,height:i,tool:b.Tools.Pencil,backgroundColor:"#ffffff",lineColor:"black",lineWidth:50,ref:function(e){return t._sketch=e}}),r.a.createElement("div",{className:"canvas-actions"},r.a.createElement("button",{disabled:n,onClick:this.onClearClick},"Clear"),r.a.createElement("button",{disabled:n,onClick:this.onRecognizeClick},"Recognize")))}},{key:"sketchImage",get:function(){return this._sketch.toDataURL()}}]),e}(n.Component)),w=y()()(k),O=(a(1119),function(t){function e(){return Object(h.a)(this,e),Object(m.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"result-component"},this.isResultPresent()?this.renderResult():this.renderNoResult())}},{key:"renderResult",value:function(){var t=this.props.digit;return r.a.createElement("div",{className:"result"},t)}},{key:"renderNoResult",value:function(){return r.a.createElement("div",{className:"no-result"},"Recognized digit will appear here")}},{key:"isResultPresent",value:function(){var t=this.props.digit;return null!==t&&void 0!==t}}]),e}(n.Component)),N=a(111),j=(a(1121),a(1300)),x=a(1302),I=a(1254),_=a(1255),S=a(1301),T=a(1298),C=a(548),D=a(1297),A=(a(1123),a(1125),function(t){var e=t.name,a=t.value;return r.a.createElement("div",{className:"measure"},r.a.createElement("div",{className:"name"},e),r.a.createElement("div",{className:"value"},a?a.toFixed(4):"N/A"))});function L(t,e){return B.apply(this,arguments)}function B(){return(B=Object(l.a)(o.a.mark(function t(e,a){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Image,r=new Promise(function(t){n.onload=function(){var e=document.createElement("canvas");e.width=a,e.height=a;var r=e.getContext("2d");r.drawImage(n,0,0,a,a);for(var i=r.getImageData(0,0,a,a),s=[],c=0,o=i.data.length/4;c<o;c+=1)s.push(i.data[4*c+3]),s.push(0),s.push(0),s.push(0);var l=new ImageData(new Uint8ClampedArray(s),28,28);t(l)}}),n.src=e,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function R(t){if(t&&0!==t.length)return t[t.length-1]}var F=function(t){var e=t.containerWidth,a=t.chartData,n=t.title;return r.a.createElement("div",{className:"training-line-chart"},r.a.createElement("div",{className:"title"},n),r.a.createElement("div",{className:"measures"},r.a.createElement(A,{name:"Accuracy",value:R(a.map(function(t){return t.accuracy}))}),r.a.createElement(A,{name:"Loss",value:R(a.map(function(t){return t.loss}))})),r.a.createElement(j.a,{aspect:3,width:e},r.a.createElement(x.a,{data:a},r.a.createElement(I.a,{dataKey:"idx",minTickGap:10}),r.a.createElement(_.a,{yAxisId:"left",label:{value:"Accuracy",angle:-90,position:"insideLeft"}}),r.a.createElement(_.a,{yAxisId:"right",orientation:"right",label:{value:"Loss",angle:-90,position:"insideRight"}}),r.a.createElement(S.a,{strokeDasharray:"3 3"}),r.a.createElement(T.a,null),r.a.createElement(C.a,null),r.a.createElement(D.a,{yAxisId:"left",type:"monotone",dataKey:"accuracy",stroke:"#8884d8",activeDot:{r:8}}),r.a.createElement(D.a,{yAxisId:"right",type:"monotone",dataKey:"loss",stroke:"#82ca9d"}))))},P=a(560),z=(a(1293),function(t){var e=t.progress,a=t.currentEpoch,n=t.epochs;return r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"text"},"Training ",r.a.createElement("span",{className:"percent"},e.toFixed(1),"%")," complete. Epoch ",a,"/",n,". To stop training, refresh or close page."),r.a.createElement(P.a,{percent:e}))}),W=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(m.a)(this,Object(p.a)(e).call(this,t))).onBatchProcessed=function(t,e,n){return a.setState(Object(u.a)({},a.state,{loss:[].concat(Object(N.a)(a.state.loss),[e]),accuracy:[].concat(Object(N.a)(a.state.accuracy),[n]),progress:t}))},a.onEpochProcessed=function(t,e,n){return a.setState(Object(u.a)({},a.state,{validationLoss:[].concat(Object(N.a)(a.state.validationLoss),[e]),validationAccuracy:[].concat(Object(N.a)(a.state.validationAccuracy),[n])}))},a.onTrainingFinished=function(t){(0,a.props.onTrainingFinished)(t)},a.onEpochsNumberChange=function(t){var e=t.target.value;q.epochs=e,a.setState(Object(u.a)({},a.state,{epochs:e}))},a.state={loss:[],accuracy:[],progress:void 0,validationLoss:[],validationAccuracy:[],trainingStarted:!1,epochs:q.trainEpochs},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"training"},this.state.trainingStarted&&this.state.progress?r.a.createElement(z,{progress:this.state.progress,currentEpoch:this.state.validationLoss.length,epochs:this.state.epochs}):this.renderNotStarted(),this.state.trainingStarted?this.renderCharts():void 0)}},{key:"renderNotStarted",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("div",null,"Training not started yet. Select number of epochs and click button to start."),r.a.createElement("div",{className:"controls"},r.a.createElement("div",null,"Number of epochs (between 2 and 10)"),r.a.createElement("input",{type:"number",min:"2",max:"10",value:this.state.epochs,onChange:this.onEpochsNumberChange}),r.a.createElement("button",{onClick:function(){return t.onTrainClick()}},"Train")))}},{key:"renderCharts",value:function(){var t=this.props.containerWidth;return r.a.createElement("div",{className:"training-charts"},r.a.createElement(F,{containerWidth:t-32,title:"Training",chartData:this.chartData}),r.a.createElement(F,{containerWidth:t-32,title:"Validation",chartData:this.chartValidationData}))}},{key:"onTrainClick",value:function(){var t=Object(l.a)(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q.loadData();case 2:return this.setState(Object(u.a)({},this.state,{trainingStarted:!0})),t.next=5,q.train(this.onBatchProcessed,this.onEpochProcessed,this.onTrainingFinished);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"chartData",get:function(){var t=this;return this.state.accuracy.map(function(e,a){return{idx:a+1,accuracy:e,loss:t.state.loss[a]}})}},{key:"chartValidationData",get:function(){var t=this;return this.state.validationAccuracy.map(function(e,a){return{idx:a+1,accuracy:e,loss:t.state.validationLoss[a]}})}}]),e}(n.Component),M=y()()(W),U=a(37),V=28,Z=28,H=V*Z,G=10,K=function(){function t(){Object(h.a)(this,t),this.imagesTensorShape=function(t){return[t/H,V,Z,1]},this.labelsTensorShape=function(t){return[t/G,G]}}return Object(d.a)(t,[{key:"load",value:function(){var t=Object(l.a)(o.a.mark(function t(){var e,a,n,r,i,s,c,l=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Image,a=document.createElement("canvas"),n=a.getContext("2d"),r=new Promise(function(t,r){e.crossOrigin="",e.onload=function(){e.width=e.naturalWidth,e.height=e.naturalHeight;var r=new ArrayBuffer(65e3*H*4);a.width=e.width,a.height=5e3;for(var i=0;i<13;i++){var s=new Float32Array(r,i*H*5e3*4,5e3*H);n.drawImage(e,0,5e3*i,e.width,5e3,0,0,e.width,5e3);for(var c=n.getImageData(0,0,a.width,a.height),o=0;o<c.data.length/4;o++)s[o]=c.data[4*o]/255}l.datasetImages=new Float32Array(r),t()},e.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"}),i=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),t.next=7,Promise.all([r,i]);case 7:return s=t.sent,c=s[1],t.t0=Uint8Array,t.next=12,c.arrayBuffer();case 12:t.t1=t.sent,this.datasetLabels=new t.t0(t.t1),this.trainImages=this.datasetImages.slice(0,55e3*H),this.testImages=this.datasetImages.slice(55e3*H),this.trainLabels=this.datasetLabels.slice(0,55e3*G),this.testLabels=this.datasetLabels.slice(55e3*G);case 18:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"trainData",get:function(){return{xs:U.g(this.trainImages,this.imagesTensorShape(this.trainImages.length)),labels:U.f(this.trainLabels,this.labelsTensorShape(this.trainLabels.length))}}},{key:"testData",get:function(){return{xs:U.g(this.testImages,this.imagesTensorShape(this.testImages.length)),labels:U.f(this.testLabels,this.labelsTensorShape(this.testLabels.length))}}}]),t}(),J=function(){function t(){Object(h.a)(this,t)}return Object(d.a)(t,null,[{key:"build",value:function(){var e=U.e();return e.add(U.b.conv2d({inputShape:[28,28,1],kernelSize:3,filters:16,activation:"relu"})),e.add(U.b.maxPooling2d({poolSize:2,strides:2})),e.add(U.b.conv2d({kernelSize:3,filters:32,activation:"relu"})),e.add(U.b.maxPooling2d({poolSize:2,strides:2})),e.add(U.b.conv2d({kernelSize:3,filters:32,activation:"relu"})),e.add(U.b.flatten()),e.add(U.b.dense({units:64,activation:"relu"})),e.add(U.b.dense({units:10,activation:"softmax"})),e.compile({optimizer:t.optimizer,loss:"categoricalCrossentropy",metrics:["accuracy"]}),e}},{key:"optimizer",get:function(){return U.h.sgd(t.LEARNING_RATE)}}]),t}();J.LEARNING_RATE=.15;var $=function(){function t(){Object(h.a)(this,t),this.trainEpochs=5,this._trainBatchCount=0,this._model=J.build(),this._data=new K}return Object(d.a)(t,[{key:"loadData",value:function(){var e=Object(l.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._data.load();case 2:this._trainData=this._data.trainData,this._testData=this._data.testData,this._totalNumBatches=Math.ceil(this._trainData.xs.shape[0]*(1-t.VALIDATION_SPLIT)/t.BATCH_SIZE)*this.trainEpochs;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(l.a)(o.a.mark(function e(a,n,r){var i,s=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._model.fit(this._trainData.xs,this._trainData.labels,{batchSize:t.BATCH_SIZE,validationSplit:t.VALIDATION_SPLIT,epochs:this.trainEpochs,callbacks:{onBatchEnd:function(t,e){return s.onTrainingBatchEnd(t,e,a)},onEpochEnd:function(t,e){return s.onTrainEpochEnd(t,e,n)}}});case 2:i=this._model.evaluate(this._testData.xs,this._testData.labels),r(i);case 4:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(t){var e=U.a(t,1).reshape([1,28,28,1]).cast("float32").div(U.d(255)),a=this._model.predict(e).dataSync();return console.log("predict - output",a),a.indexOf(Math.max.apply(Math,Object(N.a)(a)))}},{key:"onTrainingBatchEnd",value:function(){var t=Object(l.a)(o.a.mark(function t(e,a,n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._trainBatchCount++,r=this._trainBatchCount/this._totalNumBatches*100,n(r,a.loss,a.acc),t.next=5,U.c();case 5:case"end":return t.stop()}},t,this)}));return function(e,a,n){return t.apply(this,arguments)}}()},{key:"onTrainEpochEnd",value:function(){var t=Object(l.a)(o.a.mark(function t(e,a,n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._valAcc=a.val_acc,n(this._trainBatchCount,a.loss,a.acc),t.next=4,U.c();case 4:case"end":return t.stop()}},t,this)}));return function(e,a,n){return t.apply(this,arguments)}}()}]),t}();$.VALIDATION_SPLIT=.15,$.BATCH_SIZE=128;var q=new $,Q=function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(t=Object(p.a)(e)).call.apply(t,[this].concat(r)))).MNIST_SIZE=28,a.state={image:void 0,result:void 0,trainingFinished:!1},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"app"},r.a.createElement("header",{className:"app-header"},r.a.createElement("div",null,r.a.createElement("img",{src:g.a,className:"app-logo",alt:"logo"})),r.a.createElement("div",null,"TensorFlow.js demo")),r.a.createElement("section",{className:"app-content"},r.a.createElement(M,{onTrainingFinished:function(){return t.setState(Object(u.a)({},t.state,{trainingFinished:!0}))}})),r.a.createElement("section",{className:"app-content"},r.a.createElement(w,{onNewImage:function(e){return t.onNewImage(e)},disabled:!this.state.trainingFinished}),r.a.createElement(O,{digit:this.state.result})))}},{key:"onNewImage",value:function(){var t=Object(l.a)(o.a.mark(function t(e){var a,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}this.setState(Object(u.a)({},this.state,{result:void 0})),t.next=9;break;case 4:return t.next=6,L(e,this.MNIST_SIZE);case 6:a=t.sent,n=q.predict(a),this.setState(Object(u.a)({},this.state,{result:n}));case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},549:function(t,e,a){t.exports=a.p+"static/media/logo.5d5d9eef.svg"},561:function(t,e,a){t.exports=a(1296)},566:function(t,e,a){},570:function(t,e,a){},616:function(t,e){},618:function(t,e){},650:function(t,e){},651:function(t,e){},720:function(t,e){},828:function(t,e){},829:function(t,e){},862:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=862},894:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=894}},[[561,2,1]]]);
//# sourceMappingURL=main.40aa8d09.chunk.js.map