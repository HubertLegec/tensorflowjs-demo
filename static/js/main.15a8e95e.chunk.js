(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1116:function(t,e,a){},1118:function(t,e,a){},1120:function(t,e,a){},1122:function(t,e,a){},1124:function(t,e,a){},1292:function(t,e,a){},1295:function(t,e,a){"use strict";a.r(e);var n=a(2),r=a.n(n),i=a(222),s=a.n(i),c=(a(565),a(34)),o=a.n(c),l=a(56),u=a(85),h=a(54),d=a(55),p=a(97),m=a(96),f=a(98),v=(a(569),a(320)),g=a(225),b=a.n(g),E=(a(1116),function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(p.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r))))._sketch=null,a.onClearClick=function(){var t=a.props.onNewImage;a._sketch.clear(),t(void 0)},a.onRecognizeClick=function(){(0,a.props.onNewImage)(a.sketchImage)},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this,e=this.props,a=e.containerWidth,n=e.disabled,i="".concat(a-16,"px");return r.a.createElement("div",{className:"canvas"},r.a.createElement("header",{className:"canvas-header"},"Write your digit below:"),r.a.createElement(v.SketchField,{width:i,height:i,tool:v.Tools.Pencil,backgroundColor:"#ffffff",lineColor:"black",lineWidth:50,ref:function(e){return t._sketch=e}}),r.a.createElement("div",{className:"canvas-actions"},r.a.createElement("button",{disabled:n,onClick:this.onClearClick},"Clear"),r.a.createElement("button",{disabled:n,onClick:this.onRecognizeClick},"Recognize")))}},{key:"sketchImage",get:function(){return this._sketch.toDataURL()}}]),e}(n.Component)),y=b()()(E),O=(a(1118),function(t){function e(){return Object(h.a)(this,e),Object(p.a)(this,Object(m.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"result-component"},this.isResultPresent()?this.renderResult():this.renderNoResult())}},{key:"renderResult",value:function(){var t=this.props.digit;return r.a.createElement("div",{className:"result"},t)}},{key:"renderNoResult",value:function(){return r.a.createElement("div",{className:"no-result"},"Recognized digit will appear here")}},{key:"isResultPresent",value:function(){var t=this.props.digit;return null!==t&&void 0!==t}}]),e}(n.Component)),k=a(111),w=(a(1120),a(1299)),j=a(1301),N=a(1253),I=a(1254),x=a(1300),_=a(1297),S=a(548),T=a(1296),C=(a(1122),a(1124),function(t){var e=t.name,a=t.value;return r.a.createElement("div",{className:"measure"},r.a.createElement("div",{className:"name"},e),r.a.createElement("div",{className:"value"},a?a.toFixed(4):"N/A"))});function D(t,e){return A.apply(this,arguments)}function A(){return(A=Object(l.a)(o.a.mark(function t(e,a){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Image,r=new Promise(function(t){n.onload=function(){var e=document.createElement("canvas");e.width=a,e.height=a;var r=e.getContext("2d");r.drawImage(n,0,0,a,a);for(var i=r.getImageData(0,0,a,a),s=[],c=0,o=i.data.length/4;c<o;c+=1)s.push(i.data[4*c+3]),s.push(0),s.push(0),s.push(0);var l=new ImageData(new Uint8ClampedArray(s),28,28);t(l)}}),n.src=e,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function L(t){if(t&&0!==t.length)return t[t.length-1]}var B=function(t){var e=t.containerWidth,a=t.chartData,n=t.title;return r.a.createElement("div",{className:"training-line-chart"},r.a.createElement("div",{className:"title"},n),r.a.createElement("div",{className:"measures"},r.a.createElement(C,{name:"Accuracy",value:L(a.map(function(t){return t.accuracy}))}),r.a.createElement(C,{name:"Loss",value:L(a.map(function(t){return t.loss}))})),r.a.createElement(w.a,{aspect:3,width:e},r.a.createElement(j.a,{data:a},r.a.createElement(N.a,{dataKey:"idx",minTickGap:10}),r.a.createElement(I.a,{yAxisId:"left",label:{value:"Accuracy",angle:-90,position:"insideLeft"}}),r.a.createElement(I.a,{yAxisId:"right",orientation:"right",label:{value:"Loss",angle:-90,position:"insideRight"}}),r.a.createElement(x.a,{strokeDasharray:"3 3"}),r.a.createElement(_.a,null),r.a.createElement(S.a,null),r.a.createElement(T.a,{yAxisId:"left",type:"monotone",dataKey:"accuracy",stroke:"#8884d8",activeDot:{r:8}}),r.a.createElement(T.a,{yAxisId:"right",type:"monotone",dataKey:"loss",stroke:"#82ca9d"}))))},R=a(559),F=(a(1292),function(t){var e=t.progress,a=t.currentEpoch,n=t.epochs;return r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"text"},"Training ",r.a.createElement("span",{className:"percent"},e.toFixed(1),"%")," complete. Epoch ",a,"/",n,". To stop training, refresh or close page."),r.a.createElement(R.a,{percent:e}))}),P=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(p.a)(this,Object(m.a)(e).call(this,t))).onBatchProcessed=function(t,e,n){return a.setState(Object(u.a)({},a.state,{loss:[].concat(Object(k.a)(a.state.loss),[e]),accuracy:[].concat(Object(k.a)(a.state.accuracy),[n]),progress:t}))},a.onEpochProcessed=function(t,e,n){return a.setState(Object(u.a)({},a.state,{validationLoss:[].concat(Object(k.a)(a.state.validationLoss),[e]),validationAccuracy:[].concat(Object(k.a)(a.state.validationAccuracy),[n])}))},a.onTrainingFinished=function(t){(0,a.props.onTrainingFinished)(t)},a.onEpochsNumberChange=function(t){var e=t.target.value;Y.trainEpochs=e,a.setState(Object(u.a)({},a.state,{epochs:e}))},a.state={loss:[],accuracy:[],progress:void 0,validationLoss:[],validationAccuracy:[],trainingStarted:!1,epochs:Y.trainEpochs},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"training"},this.state.trainingStarted&&this.state.progress?r.a.createElement(F,{progress:this.state.progress,currentEpoch:this.state.validationLoss.length,epochs:this.state.epochs}):this.renderNotStarted(),this.state.trainingStarted?this.renderCharts():void 0)}},{key:"renderNotStarted",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("div",null,"Training not started yet. Select number of epochs and click button to start."),r.a.createElement("div",{className:"controls"},r.a.createElement("div",null,"Number of epochs (between 2 and 10)"),r.a.createElement("input",{type:"number",min:"2",max:"10",value:this.state.epochs,onChange:this.onEpochsNumberChange}),r.a.createElement("button",{onClick:function(){return t.onTrainClick()}},"Train")))}},{key:"renderCharts",value:function(){var t=this.props.containerWidth;return r.a.createElement("div",{className:"training-charts"},r.a.createElement(B,{containerWidth:t-32,title:"Training",chartData:this.chartData}),r.a.createElement(B,{containerWidth:t-32,title:"Validation",chartData:this.chartValidationData}))}},{key:"onTrainClick",value:function(){var t=Object(l.a)(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y.loadData();case 2:return this.setState(Object(u.a)({},this.state,{trainingStarted:!0})),t.next=5,Y.train(this.onBatchProcessed,this.onEpochProcessed,this.onTrainingFinished);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"chartData",get:function(){var t=this;return this.state.accuracy.map(function(e,a){return{idx:a+1,accuracy:e,loss:t.state.loss[a]}})}},{key:"chartValidationData",get:function(){var t=this;return this.state.validationAccuracy.map(function(e,a){return{idx:a+1,accuracy:e,loss:t.state.validationLoss[a]}})}}]),e}(n.Component),z=b()()(P),W=a(43),M=28,U=28,V=M*U,Z=10,H=function(){function t(){Object(h.a)(this,t),this.imagesTensorShape=function(t){return[t/V,M,U,1]},this.labelsTensorShape=function(t){return[t/Z,Z]}}return Object(d.a)(t,[{key:"load",value:function(){var t=Object(l.a)(o.a.mark(function t(){var e,a,n,r,i,s,c,l=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Image,a=document.createElement("canvas"),n=a.getContext("2d"),r=new Promise(function(t,r){e.crossOrigin="",e.onload=function(){e.width=e.naturalWidth,e.height=e.naturalHeight;var r=new ArrayBuffer(65e3*V*4);a.width=e.width,a.height=5e3;for(var i=0;i<13;i++){var s=new Float32Array(r,i*V*5e3*4,5e3*V);n.drawImage(e,0,5e3*i,e.width,5e3,0,0,e.width,5e3);for(var c=n.getImageData(0,0,a.width,a.height),o=0;o<c.data.length/4;o++)s[o]=c.data[4*o]/255}l.datasetImages=new Float32Array(r),t()},e.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"}),i=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),t.next=7,Promise.all([r,i]);case 7:return s=t.sent,c=s[1],t.t0=Uint8Array,t.next=12,c.arrayBuffer();case 12:t.t1=t.sent,this.datasetLabels=new t.t0(t.t1),this.trainImages=this.datasetImages.slice(0,55e3*V),this.testImages=this.datasetImages.slice(55e3*V),this.trainLabels=this.datasetLabels.slice(0,55e3*Z),this.testLabels=this.datasetLabels.slice(55e3*Z);case 18:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"trainData",get:function(){return{xs:Object(W.g)(this.trainImages,this.imagesTensorShape(this.trainImages.length)),labels:Object(W.f)(this.trainLabels,this.labelsTensorShape(this.trainLabels.length))}}},{key:"testData",get:function(){return{xs:Object(W.g)(this.testImages,this.imagesTensorShape(this.testImages.length)),labels:Object(W.f)(this.testLabels,this.labelsTensorShape(this.testLabels.length))}}}]),t}(),G=W.b.conv2d,K=W.b.maxPooling2d,J=W.b.flatten,q=W.b.dense,Q=function(){function t(){Object(h.a)(this,t)}return Object(d.a)(t,null,[{key:"build",value:function(){var e=Object(W.e)();return e.add(G({inputShape:[28,28,1],kernelSize:3,filters:16,activation:"relu"})),e.add(K({poolSize:2,strides:2})),e.add(G({kernelSize:3,filters:32,activation:"relu"})),e.add(K({poolSize:2,strides:2})),e.add(G({kernelSize:3,filters:32,activation:"relu"})),e.add(J()),e.add(q({units:64,activation:"relu"})),e.add(q({units:10,activation:"softmax"})),e.compile({optimizer:t.optimizer,loss:"categoricalCrossentropy",metrics:["accuracy"]}),e}},{key:"optimizer",get:function(){return W.h.sgd(t.LEARNING_RATE)}}]),t}();Q.LEARNING_RATE=.15;var X=function(){function t(){Object(h.a)(this,t),this.trainEpochs=5,this._trainBatchCount=0,this._model=Q.build(),this._data=new H}return Object(d.a)(t,[{key:"loadData",value:function(){var e=Object(l.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._data.load();case 2:this._trainData=this._data.trainData,this._testData=this._data.testData,this._totalNumBatches=Math.ceil(this._trainData.xs.shape[0]*(1-t.VALIDATION_SPLIT)/t.BATCH_SIZE)*this.trainEpochs;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(l.a)(o.a.mark(function e(a,n,r){var i,s=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._model.fit(this._trainData.xs,this._trainData.labels,{batchSize:t.BATCH_SIZE,validationSplit:t.VALIDATION_SPLIT,epochs:this.trainEpochs,callbacks:{onBatchEnd:function(t,e){return s.onTrainingBatchEnd(t,e,a)},onEpochEnd:function(t,e){return s.onTrainEpochEnd(t,e,n)}}});case 2:i=this._model.evaluate(this._testData.xs,this._testData.labels),r(i);case 4:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(t){var e=Object(W.a)(t,1).reshape([1,28,28,1]).cast("float32").div(Object(W.d)(255)),a=this._model.predict(e).dataSync();return console.log("predict - output",a),a.indexOf(Math.max.apply(Math,Object(k.a)(a)))}},{key:"onTrainingBatchEnd",value:function(){var t=Object(l.a)(o.a.mark(function t(e,a,n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._trainBatchCount++,r=this._trainBatchCount/this._totalNumBatches*100,n(r,a.loss,a.acc),t.next=5,Object(W.c)();case 5:case"end":return t.stop()}},t,this)}));return function(e,a,n){return t.apply(this,arguments)}}()},{key:"onTrainEpochEnd",value:function(){var t=Object(l.a)(o.a.mark(function t(e,a,n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._valAcc=a.val_acc,n(this._trainBatchCount,a.loss,a.acc),t.next=4,Object(W.c)();case 4:case"end":return t.stop()}},t,this)}));return function(e,a,n){return t.apply(this,arguments)}}()}]),t}();X.VALIDATION_SPLIT=.15,X.BATCH_SIZE=128;var Y=new X,$=function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(p.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).MNIST_SIZE=28,a.state={image:void 0,result:void 0,trainingFinished:!1},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"app"},r.a.createElement("section",{className:"app-content"},r.a.createElement(z,{onTrainingFinished:function(){return t.setState(Object(u.a)({},t.state,{trainingFinished:!0}))}})),r.a.createElement("section",{className:"app-content"},r.a.createElement(y,{onNewImage:function(e){return t.onNewImage(e)},disabled:!this.state.trainingFinished}),r.a.createElement(O,{digit:this.state.result})))}},{key:"onNewImage",value:function(){var t=Object(l.a)(o.a.mark(function t(e){var a,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}this.setState(Object(u.a)({},this.state,{result:void 0})),t.next=9;break;case 4:return t.next=6,D(e,this.MNIST_SIZE);case 6:a=t.sent,n=Y.predict(a),this.setState(Object(u.a)({},this.state,{result:n}));case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),e}(n.Component);s.a.render(r.a.createElement($,null),document.getElementById("root"))},560:function(t,e,a){t.exports=a(1295)},565:function(t,e,a){},569:function(t,e,a){},615:function(t,e){},617:function(t,e){},649:function(t,e){},650:function(t,e){},719:function(t,e){},827:function(t,e){},828:function(t,e){},861:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=861},893:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=893}},[[560,2,1]]]);
//# sourceMappingURL=main.15a8e95e.chunk.js.map